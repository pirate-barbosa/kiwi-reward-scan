<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UPI QR Decoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="Scan UPI QR codes to decode merchant details and check Kiwi reward eligibility" />

  <!-- QR Scanner Library (vendored locally for offline support) -->
  <script src="vendor/html5-qrcode.min.js"></script>

  <!-- Fonts: system-first with optional Google Fonts enhancement -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- PWA Icons -->
  <link rel="icon" type="image/svg+xml" href="icons/icon-192.svg" />
  <link rel="apple-touch-icon" href="icons/icon-192.svg" />
</head>

<body>

<div class="app">

  <!-- Header -->
  <header class="header">
    <div class="header__icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="3" height="3"/><line x1="21" y1="14" x2="21" y2="21"/><line x1="14" y1="21" x2="21" y2="21"/>
      </svg>
    </div>
    <h1 class="header__title">UPI QR Decoder</h1>
    <p class="header__subtitle">Scan &middot; Decode &middot; Check Rewards</p>
  </header>

  <!-- Landing State (shown before first scan) -->
  <div id="landingState" class="empty-state">
    <div class="empty-state__icon">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 3h6v6"/><path d="M9 21H3v-6"/><path d="M21 3l-7 7"/><path d="M3 21l7-7"/>
      </svg>
    </div>
    <p class="empty-state__text">Scan a UPI QR code to decode<br/>merchant details &amp; check rewards</p>
    <div class="landing-actions">
      <button class="action-btn action-btn--primary" onclick="startScanner()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Scan with Camera
      </button>
      <div class="landing-divider"><span>or</span></div>
      <button class="action-btn action-btn--secondary" onclick="document.getElementById('galleryInput').click()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        Upload QR Image
      </button>
    </div>
    <div id="galleryError" class="gallery-error" style="display:none;">
      No QR code found in this image. Please try a clearer photo.
    </div>
    <input type="file" id="galleryInput" accept="image/*" style="display:none" onchange="scanFromGallery(this)" />
  </div>

  <!-- Scan History (shown on landing when records exist) -->
  <div id="historySection" style="display:none;">
    <div id="historyList"></div>
  </div>

  <!-- Hidden element for gallery QR scanning -->
  <div id="readerGallery" style="display:none;"></div>

  <!-- Scanner (hidden until user taps Start) -->
  <section class="scanner-section" id="scannerSection" style="display:none;">
    <div class="scanner-label">
      <span class="scanner-label__dot"></span>
      Camera Active
    </div>
    <div class="scanner-wrapper">
      <div id="reader"></div>
    </div>
  </section>

  <!-- Empty State (shown while scanner is active, before decode) -->
  <div id="emptyState" class="empty-state" style="display:none;">
    <p class="empty-state__text">Point your camera at a UPI QR code<br/>to decode merchant details</p>
  </div>

  <!-- Results -->
  <div id="results" class="results">

    <div id="typeBadge"></div>

    <div class="section-title">Payment Details</div>
    <div id="merchantInfoCards"></div>

    <div class="divider"></div>
    <div class="section-title">Kiwi Rewards Eligibility</div>
    <div id="kiwiRewardsCard" class="kiwi-section"></div>

    <!-- Cashback Calculator (shown only for eligible merchants) -->
    <div id="cashbackCalculator" style="display:none;">
      <div class="divider"></div>
      <div class="section-title">Cashback Calculator</div>
      <div id="cashbackContent"></div>
    </div>

    <!-- Quick Pay -->
    <div id="payActions" style="display:none;">
      <div class="divider"></div>
      <div class="section-title">Quick Pay</div>
      <div id="payActionsContent"></div>
    </div>

    <div class="divider"></div>
    <div class="section-title">Raw UPI Data</div>

    <div class="url-card">
      <div class="url-card__header" onclick="toggleUrlExpand()">
        <span class="url-card__label">Full UPI URL</span>
        <span class="url-card__toggle" id="urlToggle">Show &#9662;</span>
      </div>
      <div class="url-card__body" id="urlBody">
        <div class="url-card__url" id="fullUpiUrl"></div>
      </div>
    </div>

    <div class="url-card">
      <div class="url-card__header" onclick="toggleParamsExpand()">
        <span class="url-card__label">All UPI Parameters</span>
        <span class="url-card__toggle" id="paramsToggle">Show &#9662;</span>
      </div>
      <div class="url-card__body" id="paramsBody">
        <table class="params-table" id="paramsTable">
          <thead><tr><th>Param</th><th>Value</th></tr></thead>
          <tbody id="paramsTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="results-actions">
      <button class="scan-again-btn visible" onclick="resetScanner()">Scan Another QR Code</button>
      <button class="gallery-link" onclick="document.getElementById('galleryInput').click()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
        Upload Image Instead
      </button>
    </div>
  </div>

  <!-- App Footer -->
  <footer class="app-footer">
    <div class="app-footer__links">
      <a href="https://github.com/pirate-barbosa/kiwi-reward-scanner" target="_blank" rel="noopener noreferrer" class="app-footer__link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
        Source Code
      </a>
      <span class="app-footer__dot">&middot;</span>
      <a href="https://buymeacoffee.com/piratebarbosa" target="_blank" rel="noopener noreferrer" class="app-footer__link app-footer__link--coffee">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        Buy Me a Coffee
      </a>
    </div>
    <div class="app-version" id="appVersion"></div>
  </footer>

</div>

<!-- App Entry Point (ES Module) -->
<script type="module" src="js/app.js"></script>

</body>
</html>
